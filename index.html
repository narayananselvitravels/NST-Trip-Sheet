<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NST Trip Sheet</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      margin: 0 auto;
      padding: 20px;
      max-width: 800px;
      background: #f4f6f9;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background: #4b2aad;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #3a1e84;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .trip-card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
    }
    .trip-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .popup, .ratePopup {
      display: none;
      position: fixed;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      width: 95%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
      flex-direction: column;
    }
    .popup.show, .ratePopup.show {
      display: flex;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 15px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #4b2aad;
      color: white;
    }
    #printContent {
      display: none;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      #printContent, #printContent * {
        visibility: visible;
      }
      #printContent {
        position: absolute;
        top: 0; left: 0; width: 100%;
      }
    }
    .invoice {
      padding: 20px;
      border: 2px solid #4b2aad;
      margin-bottom: 30px;
      background: white;
      page-break-after: always;
    }
    .invoice h2 {
      color: #4b2aad;
      border-bottom: 2px solid #4b2aad;
      padding-bottom: 5px;
      margin-bottom: 15px;
      font-size: 24px;
    }
    .invoice-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 16px;
    }
    .invoice-table th, .invoice-table td {
      border: 1px solid #4b2aad;
      padding: 10px;
      text-align: left;
    }
    .invoice-table th {
      background: #7b59d9;
      color: white;
    }
    .section-title {
      font-weight: bold;
      margin-top: 20px;
      color: #333;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h2>üìù NST Trip Sheet</h2>

<div id="mainForm">
  <label>Trip ID</label>
  <input id="tripId" readonly>

  <label>Date</label>
  <input type="date" id="tripDate">

  <label>Customer Name</label>
  <input id="custName" placeholder="Enter customer name">

  <label>Customer Number</label>
  <input id="custNumber" placeholder="Enter customer phone">

  <label>Driver Name</label>
  <input id="driverName" placeholder="Enter driver name">

  <label>Driver Number</label>
  <input id="driverNumber" placeholder="Enter driver phone">

  <label>Vehicle Model</label>
  <select id="vehicleModel" onchange="sync(true)">
    <option value="">-- Select --</option>
    <option>Innova Crysta</option>
    <option>Innova Hycross</option>
    <option>Force Urbania</option>
  </select>

  <label>Vehicle Number</label>
  <select id="vehicleNo" onchange="sync(false)">
    <option value="">-- Select --</option>
    <option>PY05N0505</option>
    <option>PY01DB1007</option>
    <option>TN14AP2084</option>
  </select>

  <label>Start Time</label>
  <input type="time" id="startTime" onchange="recalc()">

  <label>End Time</label>
  <input type="time" id="endTime" onchange="recalc()">

  <label>Duration (hrs)</label>
  <input id="duration" readonly>

  <label>Extra Hours</label>
  <input id="extraHours" readonly>

  <label>Start KM</label>
  <input type="number" id="startKM" min="0" onchange="recalc()">

  <label>End KM</label>
  <input type="number" id="endKM" min="0" onchange="recalc()">

  <label>Total KM</label>
  <input id="totalKM" readonly>

  <label>Extra KM</label>
  <input id="extraKM" readonly>

  <label>Package ‚Çπ</label>
  <input id="packageCost" readonly>

  <label>Extra Hr ‚Çπ</label>
  <input id="extraHrCost" readonly>

  <label>Extra KM ‚Çπ</label>
  <input id="extraKmCost" readonly>

  <label>Toll ‚Çπ</label>
  <input type="number" id="toll" value="0" min="0" onchange="recalc()">

  <label>Parking ‚Çπ</label>
  <input type="number" id="parking" value="0" min="0" onchange="recalc()">

  <label>Total ‚Çπ</label>
  <input id="totalCost" readonly>

  <label>Note</label>
  <textarea id="note" rows="3" placeholder="Enter notes..."></textarea>

  <!-- Hidden inputs to store rate values -->
  <input type="hidden" id="eHr">
  <input type="hidden" id="eKm">
  <input type="hidden" id="freeKm">

  <div class="btn-group">
    <button onclick="saveTrip()">üíæ Save</button>
    <button onclick="showTrips()">üìë View All</button>
    <button onclick="shareLast()">üì§ WhatsApp</button>
    <button onclick="exportPDF()">üìÑ Export PDF</button>
  </div>
  <button style="margin-top:15px;" onclick="openRates()">‚úèÔ∏è Edit Rates</button>
</div>

<!-- Trips popup -->
<div class="popup" id="tripPopup" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
  <h3 id="popupTitle">üìã All Trips</h3>
  <input type="search" id="tripSearch" placeholder="Search by ID, Customer, Driver..." oninput="searchTrips()" style="padding:8px; font-size:16px; margin-bottom:10px;">
  <div id="tripList"></div>
  <button onclick="tripPopup.classList.remove('show')">Close</button>
</div>

<!-- Rate popup -->
<div class="ratePopup" id="ratePopup" role="dialog" aria-modal="true" aria-labelledby="rateTitle">
  <h3 id="rateTitle">‚úèÔ∏è Edit Vehicle Rates</h3>
  <table>
    <thead>
      <tr>
        <th>Model</th><th>Package ‚Çπ</th><th>Extra Hr ‚Çπ</th><th>Extra KM ‚Çπ</th><th>Free KM</th>
      </tr>
    </thead>
    <tbody id="rateRows"></tbody>
  </table>
  <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
    <button onclick="saveRates()">Save Rates</button>
    <button onclick="ratePopup.classList.remove('show')">Cancel</button>
  </div>
</div>

<script>
  // LocalStorage keys
  const RKEY = 'nst-rates';
  const TKEY = 'nst-trips';

  // Elements shortcuts
  const tripId = document.getElementById('tripId');
  const tripDate = document.getElementById('tripDate');
  const custName = document.getElementById('custName');
  const custNumber = document.getElementById('custNumber');
  const driverName = document.getElementById('driverName');
  const driverNumber = document.getElementById('driverNumber');
  const vehicleModel = document.getElementById('vehicleModel');
  const vehicleNo = document.getElementById('vehicleNo');
  const startTime = document.getElementById('startTime');
  const endTime = document.getElementById('endTime');
  const duration = document.getElementById('duration');
  const extraHours = document.getElementById('extraHours');
  const startKM = document.getElementById('startKM');
  const endKM = document.getElementById('endKM');
  const totalKM = document.getElementById('totalKM');
  const extraKM = document.getElementById('extraKM');
  const packageCost = document.getElementById('packageCost');
  const extraHrCost = document.getElementById('extraHrCost');
  const extraKmCost = document.getElementById('extraKmCost');
  const toll = document.getElementById('toll');
  const parking = document.getElementById('parking');
  const totalCost = document.getElementById('totalCost');
  const note = document.getElementById('note');
  const eHr = document.getElementById('eHr');
  const eKm = document.getElementById('eKm');
  const freeKm = document.getElementById('freeKm');

  const tripPopup = document.getElementById('tripPopup');
  const tripList = document.getElementById('tripList');
  const tripSearch = document.getElementById('tripSearch');

  const ratePopup = document.getElementById('ratePopup');
  const rateRows = document.getElementById('rateRows');

  // Rates data
  let rates = JSON.parse(localStorage.getItem(RKEY)) || {
    "Innova Crysta": { pkg: 7500, hr: 1000, km: 20, free: 80, no: "PY05N0505" },
    "Innova Hycross": { pkg: 8500, hr: 1200, km: 24, free: 60, no: "PY01DB1007" },
    "Force Urbania": { pkg: 9500, hr: 1500, km: 26, free: 70, no: "TN14AP2084" }
  };

  let editingId = null;

  // Sync vehicle model & number, and load rates accordingly
  function sync(fromModel) {
    if(fromModel){
      let model = vehicleModel.value;
      if(rates[model]){
        vehicleNo.value = rates[model].no;
        packageCost.value = rates[model].pkg;
        eHr.value = rates[model].hr;
        eKm.value = rates[model].km;
        freeKm.value = rates[model].free;
      } else {
        vehicleNo.value = '';
        packageCost.value = '';
        eHr.value = '';
        eKm.value = '';
        freeKm.value = '';
      }
    } else {
      let no = vehicleNo.value;
      for(let m in rates){
        if(rates[m].no === no){
          vehicleModel.value = m;
          sync(true);
          break;
        }
      }
    }
    recalc();
  }

  // Time formatting to 12-hour am/pm
  function to12Hr(timeStr){
    if(!timeStr) return "";
    let [h,m] = timeStr.split(":");
    let hour = parseInt(h);
    let suffix = hour >= 12 ? "PM" : "AM";
    hour = hour % 12 || 12;
    return `${hour}:${m} ${suffix}`;
  }

  // Date formatting DD-MM-YYYY
  function formatDate(dateStr){
    if(!dateStr) return "";
    let d = new Date(dateStr);
    return `${String(d.getDate()).padStart(2,'0')}-${String(d.getMonth()+1).padStart(2,'0')}-${d.getFullYear()}`;
  }

  // Recalculate duration, extra hours, kms and costs
  function recalc(){
    // Duration & extra hours
    if(startTime.value && endTime.value){
      let s = new Date(`1970-01-01T${startTime.value}`);
      let e = new Date(`1970-01-01T${endTime.value}`);
      if(e < s) e.setDate(e.getDate() + 1); // Cross midnight support
      let diffMs = e - s;
      let diffH = diffMs / (1000 * 60 * 60);
      let dur = Math.ceil(diffH*100)/100; // rounded to 2 decimals
      duration.value = dur.toFixed(2);

      let extra = Math.max(0, Math.ceil(dur) - 8);
      extraHours.value = extra;
    } else {
      duration.value = '';
      extraHours.value = '';
    }

    // KM calculation
    let startKmVal = parseFloat(startKM.value);
    let endKmVal = parseFloat(endKM.value);
    if(!isNaN(startKmVal) && !isNaN(endKmVal) && endKmVal >= startKmVal){
      let tot = endKmVal - startKmVal;
      totalKM.value = tot.toFixed(2);
      let freeKmVal = parseFloat(freeKm.value) || 0;
      let extraK = Math.max(0, tot - freeKmVal);
      extraKM.value = extraK.toFixed(2);
    } else {
      totalKM.value = '';
      extraKM.value = '';
    }

    // Cost calculations
    let pkg = parseFloat(packageCost.value) || 0;
    let hr = parseFloat(extraHours.value) || 0;
    let hrRate = parseFloat(eHr.value) || 0;
    let kmExtra = parseFloat(extraKM.value) || 0;
    let kmRate = parseFloat(eKm.value) || 0;
    let tollVal = parseFloat(toll.value) || 0;
    let parkVal = parseFloat(parking.value) || 0;

    extraHrCost.value = (hr * hrRate).toFixed(2);
    extraKmCost.value = (kmExtra * kmRate).toFixed(2);

    let total = pkg + (hr * hrRate) + (kmExtra * kmRate) + tollVal + parkVal;
    totalCost.value = total.toFixed(2);
  }

  // Generate new Trip ID (#NST001, #NST002, ...)
  function genId(){
    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    let nums = trips.map(t=>{
      let m = t.id.match(/#NST(\d+)/);
      return m ? parseInt(m[1]) : 0;
    }).filter(n=>n>0);
    let maxNum = nums.length ? Math.max(...nums) : 0;
    let nextNum = maxNum + 1;
    return '#NST' + String(nextNum).padStart(3,'0');
  }

  // Save trip data
  function saveTrip(){
    if(!tripDate.value || !custName.value || !driverName.value || !vehicleModel.value){
      alert("Please fill required fields: Date, Customer Name, Driver Name, Vehicle Model.");
      return;
    }
    let trip = {
      id: editingId || tripId.value || genId(),
      date: tripDate.value,
      cust: custName.value.trim(),
      custNum: custNumber.value.trim(),
      driver: driverName.value.trim(),
      driverNum: driverNumber.value.trim(),
      model: vehicleModel.value,
      no: vehicleNo.value,
      start: startTime.value,
      end: endTime.value,
      duration: duration.value,
      extraHr: extraHours.value,
      startKM: startKM.value,
      endKM: endKM.value,
      totalKM: totalKM.value,
      extraKM: extraKM.value,
      pkg: packageCost.value,
      hrCost: extraHrCost.value,
      kmCost: extraKmCost.value,
      toll: toll.value,
      park: parking.value,
      total: totalCost.value,
      note: note.value.trim()
    };

    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    if(editingId){
      let idx = trips.findIndex(t => t.id === editingId);
      if(idx !== -1) trips[idx] = trip;
    } else {
      trips.push(trip);
    }
    localStorage.setItem(TKEY, JSON.stringify(trips));
    alert("Trip saved successfully!");
    editingId = null;
    clearForm();
  }

  // Clear form and generate new trip id
  function clearForm(){
    tripId.value = genId();
    tripDate.value = '';
    custName.value = '';
    custNumber.value = '';
    driverName.value = '';
    driverNumber.value = '';
    vehicleModel.value = '';
    vehicleNo.value = '';
    startTime.value = '';
    endTime.value = '';
    duration.value = '';
    extraHours.value = '';
    startKM.value = '';
    endKM.value = '';
    totalKM.value = '';
    extraKM.value = '';
    packageCost.value = '';
    extraHrCost.value = '';
    extraKmCost.value = '';
    toll.value = 0;
    parking.value = 0;
    totalCost.value = '';
    note.value = '';
    eHr.value = '';
    eKm.value = '';
    freeKm.value = '';
  }

  // Show all trips popup
  function showTrips(){
    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    tripSearch.value = '';
    renderTrips(trips);
    tripPopup.classList.add('show');
  }

  // Render trip list with optional filtered trips
  function renderTrips(trips){
    tripList.innerHTML = '';
    if(trips.length === 0){
      tripList.innerHTML = '<p>No trips saved yet.</p>';
      return;
    }
    trips.forEach(t=>{
      let div = document.createElement('div');
      div.className = 'trip-card';
      div.innerHTML = `
        <b>${t.id}</b> (${formatDate(t.date)})<br>
        <b>${t.model}</b> - ${t.no}<br>
        ${to12Hr(t.start)} ‚Üí ${to12Hr(t.end)} (${t.duration}h)<br>
        Extra Hr: ${t.extraHr} | Extra KM: ${t.extraKM}<br>
        Toll: ‚Çπ${t.toll} | Parking: ‚Çπ${t.park}<br>
        <b>Total: ‚Çπ${t.total}</b>
        <div class="trip-actions">
          <button onclick="editTrip('${t.id}')">‚úèÔ∏è Edit</button>
          <button onclick="deleteTrip('${t.id}')">‚ùå Delete</button>
          <button onclick="shareTrip('${t.id}')">üì§ Share</button>
        </div>`;
      tripList.appendChild(div);
    });
  }

  // Search trips filter
  function searchTrips(){
    let q = tripSearch.value.toLowerCase();
    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    let filtered = trips.filter(t=>{
      return t.id.toLowerCase().includes(q) ||
             (t.cust && t.cust.toLowerCase().includes(q)) ||
             (t.driver && t.driver.toLowerCase().includes(q)) ||
             (t.model && t.model.toLowerCase().includes(q)) ||
             (t.no && t.no.toLowerCase().includes(q));
    });
    renderTrips(filtered);
  }

  // Edit trip: load trip data into main form
  function editTrip(id){
    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    let t = trips.find(x=>x.id === id);
    if(!t) return alert("Trip not found!");
    editingId = t.id;
    tripId.value = t.id;
    tripDate.value = t.date;
    custName.value = t.cust;
    custNumber.value = t.custNum;
    driverName.value = t.driver;
    driverNumber.value = t.driverNum;
    vehicleModel.value = t.model;
    sync(true);  // to load vehicleNo and rates
    vehicleNo.value = t.no;
    startTime.value = t.start;
    endTime.value = t.end;
    duration.value = t.duration;
    extraHours.value = t.extraHr;
    startKM.value = t.startKM;
    endKM.value = t.endKM;
    totalKM.value = t.totalKM;
    extraKM.value = t.extraKM;
    packageCost.value = t.pkg;
    extraHrCost.value = t.hrCost;
    extraKmCost.value = t.kmCost;
    toll.value = t.toll;
    parking.value = t.park;
    totalCost.value = t.total;
    note.value = t.note;
    tripPopup.classList.remove('show');
  }

  // Delete trip from storage & refresh list
  function deleteTrip(id){
    if(!confirm("Are you sure you want to delete this trip?")) return;
    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    trips = trips.filter(t=>t.id !== id);
    localStorage.setItem(TKEY, JSON.stringify(trips));
    showTrips();
  }

  // Share trip on WhatsApp
  function shareTrip(id){
  let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
  let t = trips.find(x => x.id === id);
  if (!t) return alert("Trip not found!");
  
  const msg = `
üìã *TRIP SUMMARY*
*Trip ID:* ${t.id}
*Date:* ${formatDate(t.date)}

üë§ *Customer Info*
‚Ä¢ Name: ${t.cust}
‚Ä¢ Number: ${t.custNum}

üë®‚Äç‚úàÔ∏è *Driver Info*
‚Ä¢ Name: ${t.driver}
‚Ä¢ Number: ${t.driverNum}

üöò *Vehicle Info*
‚Ä¢ Model: ${t.model}
‚Ä¢ Number: ${t.no}

üïí *Time & Distance*
‚Ä¢ Start Time: ${to12Hr(t.start)}
‚Ä¢ End Time: ${to12Hr(t.end)}
‚Ä¢ Duration: ${t.duration} hrs
‚Ä¢ Extra Hours: ${t.extraHr}
‚Ä¢ Total KM: ${t.totalKM} km
‚Ä¢ Extra KM: ${t.extraKM} km

üí∞ *Billing*
‚Ä¢ Package: ‚Çπ${t.pkg}
‚Ä¢ Extra Hr: ‚Çπ${t.hrCost}
‚Ä¢ Extra KM: ‚Çπ${t.kmCost}
‚Ä¢ Toll: ‚Çπ${t.toll}
‚Ä¢ Parking: ‚Çπ${t.park}
‚Ä¢ Total: ‚Çπ${t.total}

üìù *Note:* ${t.note || '-'}

üôè Thank you for choosing *NST Travels*`;

  const whatsappURL = "https://wa.me/?text=" + encodeURIComponent(msg.trim());
  window.open(whatsappURL);
}

  // Share last saved trip on WhatsApp
  function shareLast(){
    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    if(trips.length) shareTrip(trips[trips.length-1].id);
    else alert("No trips saved yet!");
  }

  // Rate editing popup
  function openRates(){
    rateRows.innerHTML = '';
    for(let m in rates){
      let r = rates[m];
      rateRows.innerHTML += `<tr>
        <td>${m}</td>
        <td><input type="number" min="0" value="${r.pkg}" onchange="rates['${m}'].pkg=+this.value"></td>
        <td><input type="number" min="0" value="${r.hr}" onchange="rates['${m}'].hr=+this.value"></td>
        <td><input type="number" min="0" value="${r.km}" onchange="rates['${m}'].km=+this.value"></td>
        <td><input type="number" min="0" value="${r.free}" onchange="rates['${m}'].free=+this.value"></td>
      </tr>`;
    }
    ratePopup.classList.add('show');
  }
  function saveRates(){
    localStorage.setItem(RKEY, JSON.stringify(rates));
    ratePopup.classList.remove('show');
    alert("Rates saved.");
    sync(true);
    recalc();
  }

  // Export all trips as printable HTML (simplified PDF workaround)
  function exportPDF(){
    let trips = JSON.parse(localStorage.getItem(TKEY) || '[]');
    if(trips.length === 0){
      alert("No trips to export.");
      return;
    }
    let htmlContent = '';
    trips.forEach(t => {
      htmlContent += `
        <div class="invoice">
          <h2>NST Travels ‚Äì Trip Invoice</h2>
          <p><strong>Trip ID:</strong> ${t.id}</p>
          <p><strong>Date:</strong> ${formatDate(t.date)}</p>

          <div class="section-title">Customer Info</div>
          <p>Name: ${t.cust}<br>Number: ${t.custNum}</p>

          <div class="section-title">Driver Info</div>
          <p>Name: ${t.driver}<br>Number: ${t.driverNum}</p>

          <div class="section-title">Vehicle Info</div>
          <p>Model: ${t.model}<br>Vehicle Number: ${t.no}</p>

          <div class="section-title">Time & Distance</div>
          <table class="invoice-table">
            <thead>
              <tr><th>Start</th><th>End</th><th>Duration (hrs)</th><th>Extra Hours</th><th>Total KM</th><th>Extra KM</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>${to12Hr(t.start)}</td>
                <td>${to12Hr(t.end)}</td>
                <td>${t.duration}</td>
                <td>${t.extraHr}</td>
                <td>${t.totalKM}</td>
                <td>${t.extraKM}</td>
              </tr>
            </tbody>
          </table>

          <div class="section-title">Billing</div>
          <table class="invoice-table">
            <thead>
              <tr><th>Package ‚Çπ</th><th>Extra Hr ‚Çπ</th><th>Extra KM ‚Çπ</th><th>Toll ‚Çπ</th><th>Parking ‚Çπ</th><th>Total ‚Çπ</th></tr>
            </thead>
            <tbody>
              <tr>
                <td>‚Çπ${t.pkg}</td>
                <td>‚Çπ${t.hrCost}</td>
                <td>‚Çπ${t.kmCost}</td>
                <td>‚Çπ${t.toll}</td>
                <td>‚Çπ${t.park}</td>
                <td><strong>‚Çπ${t.total}</strong></td>
              </tr>
            </tbody>
          </table>

          <div class="section-title">Note</div>
          <p>${t.note || '-'}</p>

          <p style="text-align:center; margin-top:30px; font-style:italic; color:#666;">üôè Thank you for choosing NST Travels</p>
        </div>
      `;
    });

    let printWindow = window.open('', '', 'width=900,height=700');
    printWindow.document.write(`
      <html><head><title>NST Trip Invoices</title>
      <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 20px; background: #fff; }
        .invoice { border: 2px solid #4b2aad; padding: 20px; margin-bottom: 30px; page-break-after: always; }
        h2 { color: #4b2aad; border-bottom: 2px solid #4b2aad; padding-bottom: 5px; margin-bottom: 15px; }
        .section-title { font-weight: bold; margin-top: 20px; font-size: 18px; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 16px; }
        th, td { border: 1px solid #4b2aad; padding: 10px; text-align: left; }
        th { background-color: #7b59d9; color: white; }
      </style>
      </head><body>${htmlContent}</body></html>
    `);
    printWindow.document.close();
    printWindow.focus();
    printWindow.print();
  }

  // Initialize form
  clearForm();

  // Sync rates & vehicle on vehicle model change
  vehicleModel.addEventListener('change', () => { sync(true); });
  vehicleNo.addEventListener('change', () => { sync(false); });

  // Recalc on relevant input changes
  startTime.addEventListener('change', recalc);
  endTime.addEventListener('change', recalc);
  startKM.addEventListener('input', recalc);
  endKM.addEventListener('input', recalc);
  toll.addEventListener('input', recalc);
  parking.addEventListener('input', recalc);

</script>

</body>
</html>
