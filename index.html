<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NST Trip Sheet</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background: #f4f6f9; padding: 20px; margin: 0; }
    label { font-weight: 600; display: block; margin-top: 10px; }
    input, select, textarea, button { width: 100%; padding: 10px; margin-top: 5px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; }
    button { background-color: #4b2aad; color: white; cursor: pointer; border: none; }
    button:hover { background-color: #3a1f94; }
    .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
    .trip-card { background: white; border: 1px solid #ccc; padding: 15px; margin-top: 15px; border-radius: 8px; }
    .trip-actions { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 15px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { background-color: #4b2aad; color: white; }
    .section-title { font-weight: bold; margin-top: 20px; font-size: 18px; color: #333; }
    #sharedTrips { margin-top: 30px; }
  </style>
</head>
<body>
<h2>üìù NST Trip Sheet</h2>
<div id="mainForm">
  <label>Trip ID</label>
  <input id="tripId" readonly />

  <label>Date</label>
  <input type="date" id="tripDate" onchange="updateDisplayDate()" />
  <div id="dateFormatted" style="margin-top: 10px; font-weight: 600;"></div>

  <label>Customer Name</label>
  <input id="custName" />

  <label>Customer Number</label>
  <input id="custNumber" />

  <label>Driver Name</label>
  <select id="driverName" onchange="syncDriver(true)">
    <option value="">-- Select --</option>
    <option value="Perumal">Perumal</option>
    <option value="Siva">Siva</option>
  </select>

  <label>Driver Mobile Number</label>
  <select id="driverNumber" onchange="syncDriver(false)">
    <option value="">-- Select --</option>
    <option value="9699994563">9699994563</option>
    <option value="9551208961">9551208961</option>
  </select>
  <label>Vehicle Model</label>
  <select id="vehicleModel" onchange="syncVehicle(true)">
    <option value="">-- Select --</option>
    <option>Innova Crysta</option>
    <option>Innova Hycross</option>
    <option>Force Urbania</option>
  </select>

  <label>Vehicle Number</label>
  <select id="vehicleNo" onchange="syncVehicle(false)">
    <option value="">-- Select --</option>
    <option>PY05N0505</option>
    <option>PY01DB1007</option>
    <option>TN14AP2084</option>
  </select>

  <label>Start Time</label>
  <input type="time" id="startTime" />

  <label>End Time</label>
  <input type="time" id="endTime" />

  <label>Start KM</label>
  <input type="number" id="startKM" />

  <label>End KM</label>
  <input type="number" id="endKM" />

  <label>Parking ‚Çπ</label>
  <input type="number" id="parking" value="0" />

  <label>Toll ‚Çπ</label>
  <input type="number" id="toll" value="0" />

  <label>Note</label>
  <textarea id="note" rows="3"></textarea>

  <div class="btn-group">
    <button onclick="shareTrip()">üì§ Share WhatsApp</button>
    <button onclick="viewShared()">üìë View Shared Trips</button>
  </div>
</div>

<div id="sharedTrips"></div>

<script>
let tripCounter = 1;
let sharedData = JSON.parse(localStorage.getItem("shared-trips") || "[]");
let drivers = {
  "Perumal": "9699994563",
  "Siva": "9551208961"
};
let vehicles = {
  "Innova Crysta": "PY05N0505",
  "Innova Hycross": "PY01DB1007",
  "Force Urbania": "TN14AP2084"
};

function updateDisplayDate() {
  const raw = tripDate.value;
  const d = new Date(raw);
  if (!isNaN(d)) {
    const formatted = `${String(d.getDate()).padStart(2, '0')}-${d.toLocaleString('default', { month: 'long' })}-${d.getFullYear()}`;
    dateFormatted.innerText = `Selected Date: ${formatted}`;
  } else {
    dateFormatted.innerText = "";
  }
}

function to12Hr(t) {
  const [h, m] = t.split(":");
  const hour = +h % 12 || 12;
  const suffix = +h >= 12 ? "PM" : "AM";
  return `${hour}:${m} ${suffix}`;
}

function syncDriver(fromName) {
  if (fromName) {
    driverNumber.value = drivers[driverName.value] || "";
  } else {
    driverName.value = Object.keys(drivers).find(name => drivers[name] === driverNumber.value) || "";
  }
}

function syncVehicle(fromModel) {
  if (fromModel) {
    vehicleNo.value = vehicles[vehicleModel.value] || "";
  } else {
    vehicleModel.value = Object.keys(vehicles).find(m => vehicles[m] === vehicleNo.value) || "";
  }
}

function generateTripId() {
  return "#NST" + String(tripCounter).padStart(3, '0');
}

function shareTrip() {
  if (!tripDate.value) return alert("Please select a date.");
  const id = generateTripId();
  const d = new Date(tripDate.value);
  const msg = `üìã *TRIP SUMMARY*\n\n*TRIP ID:* ${id}\n*DATE:* ${String(d.getDate()).padStart(2, '0')}-${String(d.getMonth()+1).padStart(2, '0')}-${d.getFullYear()}
\nüë§ *CUSTOMER INFO*\n‚Ä¢ Name: ${custName.value}\n‚Ä¢ Number: ${custNumber.value}
\nüë®‚Äç‚úà *DRIVER INFO*\n‚Ä¢ Name: ${driverName.value}\n‚Ä¢ Number: ${driverNumber.value}
\nüöò *VEHICLE INFO*\n‚Ä¢ Model: ${vehicleModel.value}\n‚Ä¢ Vehicle No: ${vehicleNo.value}
\nüïí *TIME & DISTANCE*\n‚Ä¢ Start Time: ${to12Hr(startTime.value)}\n‚Ä¢ End Time: ${to12Hr(endTime.value)}
\n‚Ä¢ Total KM: ${endKM.value - startKM.value} km
\n‚Ä¢ Parking: ‚Çπ${parking.value}\n‚Ä¢ Toll: ‚Çπ${toll.value}
\nüìù *Note:* ${note.value || "-"}`;

  const win = window.open("https://wa.me/?text=" + encodeURIComponent(msg));
  if (win) {
    sharedData.push({
      id,
      date: tripDate.value,
      custName: custName.value,
      custNumber: custNumber.value,
      driverName: driverName.value,
      driverNumber: driverNumber.value,
      vehicleModel: vehicleModel.value,
      vehicleNo: vehicleNo.value,
      startTime: startTime.value,
      endTime: endTime.value,
      totalKM: endKM.value - startKM.value,
      parking: parking.value,
      toll: toll.value,
      note: note.value
    });
    localStorage.setItem("shared-trips", JSON.stringify(sharedData));
    tripCounter++;
    tripId.value = generateTripId();
  }
}

function viewShared() {
  if (!sharedData.length) return sharedTrips.innerHTML = "<p>No shared trips yet.</p>";
  let html = `<h3>üìã Shared Trips</h3><table><tr><th>Trip ID</th><th>Date</th><th>Customer</th><th>Driver</th><th>Vehicle</th><th>Time</th><th>KM</th><th>Charges</th><th>Note</th></tr>`;
  sharedData.forEach(t => {
    const d = new Date(t.date.replace(/-/g, '/'));
    const formattedDate = `${String(d.getDate()).padStart(2, '0')}-${d.toLocaleString('default', { month: 'long' })}-${d.getFullYear()}`;
    html += `<tr>
      <td>${t.id}</td>
      <td>${formattedDate}</td>
      <td>${t.custName}<br>${t.custNumber}</td>
      <td>${t.driverName}<br>${t.driverNumber}</td>
      <td>${t.vehicleModel}<br>${t.vehicleNo}</td>
      <td>${to12Hr(t.startTime)} ‚Üí ${to12Hr(t.endTime)}</td>
      <td>${t.totalKM} km</td>
      <td>Parking: ‚Çπ${t.parking}<br>Toll: ‚Çπ${t.toll}</td>
      <td>${t.note || "-"}</td>
    </tr>`;
  });
  html += "</table>";
  sharedTrips.innerHTML = html;
}

tripId.value = generateTripId();
</script>
</body>
</html>
