<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NST Trip Sheet</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Poppins',sans-serif;margin:0 auto;padding:20px;max-width:800px;background:#f4f6f9 }
    h2 { color:#4b2aad }
    label { font-weight:bold;margin-top:10px;display:block }
    input, select, textarea, button { width:100%;padding:10px;margin:5px 0 15px;border:1px solid #ccc;border-radius:5px;font-size:16px }
    button { background:#4b2aad;color:#fff;border:none;cursor:pointer }
    button:hover { background:#3a208b }
  </style>
</head>
<body>

<h2>üìù NST Trip Sheet</h2>

<label>Trip ID</label><input id="tripId" readonly>
<label>Date</label><input type="date" id="tripDate">
<label>Customer Name</label><input id="custName">
<label>Customer Number</label><input id="custNumber">

<label>Vehicle Model</label>
<select id="vehicleModel" onchange="applyRates()">
  <option value="">-- Select --</option>
  <option>Innova Crysta</option>
  <option>Innova Hycross</option>
  <option>Force Urbania</option>
</select>

<label>Start Time</label><input type="time" id="startTime" onchange="recalc()">
<label>End Time</label><input type="time" id="endTime" onchange="recalc()">
<label>Start KM</label><input type="number" id="startKM" onchange="recalc()">
<label>End KM</label><input type="number" id="endKM" onchange="recalc()">

<label>Duration</label><input id="duration" readonly>
<label>Extra Hours</label><input id="extraHours" readonly>
<label>Total KM</label><input id="totalKM" readonly>
<label>Extra KM</label><input id="extraKM" readonly>

<button onclick="share()">üì§ Share Trip</button>

<script>
  let rates = {};

  function loadRates() {
    const r = localStorage.getItem("vehicle-packages");
    rates = r ? JSON.parse(r) : {};
  }

  function genId() {
    let n = parseInt(localStorage.getItem("trip-seq")||"1");
    return "#NST"+String(n).padStart(3,"0");
  }

  function reserveNextId() {
    let c = parseInt(localStorage.getItem("trip-seq")||"1");
    localStorage.setItem("trip-seq",c+1);
    tripId.value = genId();
  }

  function applyRates() {
    recalc();
  }

  function recalc() {
    const model = vehicleModel.value;
    if (!model || !rates[model]) return;

    const { freeHrs, freeKm } = rates[model];
    let s = startTime.value, e = endTime.value;
    let dur = 0;

    if (s && e) {
      let st = new Date(`2000-01-01T${s}`);
      let et = new Date(`2000-01-01T${e}`);
      dur = Math.ceil((et - st)/3600000);
      if (dur < 0) dur += 24;
      duration.value = dur;
      extraHours.value = dur > freeHrs ? dur - freeHrs : 0;
    }

    let km = endKM.value - startKM.value;
    totalKM.value = km;
    extraKM.value = km > freeKm ? km - freeKm : 0;
  }

  function share() {
    alert("Shared Trip: " + tripId.value);
    reserveNextId();
  }

  loadRates();
  tripId.value = genId();
</script>

</body>
</html>
