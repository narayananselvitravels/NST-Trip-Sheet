<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NST Trip Sheet</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0 auto;
      padding: 20px;
      max-width: 850px;
      background: #f4f6f9;
    }
    label {
      font-weight: 600;
      margin-top: 10px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 15px;
    }
    button {
      background: #4b2aad;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #3a2189;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .trip-card {
      background: white;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
    }
    .trip-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .popup, .ratePopup {
      display: none;
      position: fixed;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      width: 95%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      z-index: 1000;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 15px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #4b2aad;
      color: white;
    }
    #printContent { display: none; }
    @media print {
      body * { visibility: hidden; }
      #printContent, #printContent * { visibility: visible; }
      #printContent { position: absolute; top: 0; left: 0; width: 100%; }
    }
  </style>
</head>
<body>
<h2>üìù NST Trip Sheet</h2>
<div id="mainForm">
  <label>Trip ID</label><input id="tripId" readonly>
  <label>Date</label><input type="date" id="tripDate">
  <label>Customer Name</label><input id="custName">
  <label>Customer Number</label><input id="custNumber">
  <label>Driver Name</label><input id="driverName">
  <label>Driver Number</label><input id="driverNumber">
  <label>Vehicle Model</label>
  <select id="vehicleModel" onchange="sync(true)">
    <option value="">-- Select --</option>
    <option>Innova Crysta</option>
    <option>Innova Hycross</option>
    <option>Force Urbania</option>
  </select>
  <label>Vehicle Number</label>
  <select id="vehicleNo" onchange="sync(false)">
    <option value="">-- Select --</option>
    <option>PY05N0505</option>
    <option>PY01DB1007</option>
    <option>TN14AP2084</option>
  </select>

  <label>Start Time</label><input type="time" id="startTime" onchange="recalc()">
  <label>End Time</label><input type="time" id="endTime" onchange="recalc()">
  <label>Duration (hrs)</label><input id="duration" readonly>
  <label>Extra Hours</label><input id="extraHours" readonly>
  <label>Start KM</label><input type="number" id="startKM" onchange="recalc()">
  <label>End KM</label><input type="number" id="endKM" onchange="recalc()">
  <label>Total KM</label><input id="totalKM" readonly>
  <label>Extra KM</label><input id="extraKM" readonly>
  <label>Package ‚Çπ</label><input id="packageCost" readonly>
  <label>Extra Hr ‚Çπ</label><input id="extraHrCost" readonly>
  <label>Extra KM ‚Çπ</label><input id="extraKmCost" readonly>
  <label>Toll ‚Çπ</label><input type="number" id="toll" value="0" onchange="recalc()">
  <label>Parking ‚Çπ</label><input type="number" id="parking" value="0" onchange="recalc()">
  <label>Total ‚Çπ</label><input id="totalCost" readonly>
  <label>Note</label><textarea id="note" rows="3" placeholder="Enter notes..."></textarea>
  <input type="hidden" id="eHr">
  <input type="hidden" id="eKm">
  <input type="hidden" id="freeKm">

  <div class="btn-group">
    <button onclick="saveTrip()">üíæ Save</button>
    <button onclick="showTrips()">üìë View All</button>
    <button onclick="shareLast()">üì§ WhatsApp</button>
    <button onclick="exportPDF()">üìÑ Export PDF</button>
  </div>
  <button style="margin-top:15px;" onclick="openRates()">‚úèÔ∏è Edit Rates</button>
</div>

<!-- Popup for Viewing Trips -->
<div class="popup" id="tripPopup">
  <h3>üìã All Trips</h3>
  <div id="tripList"></div>
  <button onclick="tripPopup.style.display='none'">Close</button>
</div>

<!-- Popup for Editing Rates -->
<div class="ratePopup" id="ratePopup">
  <h3>‚úèÔ∏è Edit Vehicle Rates</h3>
  <table>
    <thead><tr><th>Model</th><th>Package ‚Çπ</th><th>Extra Hr ‚Çπ</th><th>Extra KM ‚Çπ</th><th>Free KM</th></tr></thead>
    <tbody id="rateRows"></tbody>
  </table>
  <button onclick="saveRates()">Save Rates</button>
  <button onclick="ratePopup.style.display='none'">Cancel</button>
</div>

<div id="printContent"></div>
<script>
