<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel â€“ NST Travels</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family:'Poppins',sans-serif; background:#f4f6f9; max-width:800px; margin:30px auto; padding:20px }
    h2,h3 { color:#4b2aad }
    .section { background:white; padding:20px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1); margin-bottom:20px }
    button { background:#4b2aad; color:white; border:none; padding:12px 20px; border-radius:5px; font-size:16px; cursor:pointer; margin-right:10px }
    button:hover { background:#3a208b }
    .danger { background:#dc3545 }
    .danger:hover { background:#b02a37 }
    input { width:100%; padding:8px; margin-bottom:10px; font-size:14px }
    label { font-weight:600; margin-top:10px; display:block }
    .rate-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:10px; margin-bottom:10px }
    .rate-box { border:1px solid #ddd; border-radius:6px; padding:10px; background:#fafafa }
  </style>
</head><body>

<h2>ğŸ› ï¸ NST Admin Panel</h2>

<div class="section">
  <h3>ğŸ“Š Shared Trip Stats</h3>
  <p><strong>Trips Shared:</strong> <span id="tripCount">0</span></p>
  <p><strong>Current Trip ID:</strong> <span id="currentId">#NST001</span></p>
  <button onclick="exportTrips()">ğŸ“¥ Export Shared Trips (Excel)</button>
  <button onclick="showEditRates()">âœï¸ Edit Vehicle Rates</button>
</div>

<div class="section">
  <h3>âš ï¸ Reset System</h3>
  <p>This will remove all trip data and reset the Trip ID to <strong>#NST001</strong>.</p>
  <button class="danger" onclick="resetAll()">ğŸ—‘ï¸ Reset All Data</button>
</div>

<div class="section" id="editRatesPanel" style="display:none">
  <h3>âœï¸ Edit Vehicle Rates</h3>
  <form id="ratesForm">
    <div id="ratesContainer"></div>
    <button type="submit">ğŸ’¾ Save Rates</button>
    <button type="button" class="danger" onclick="hideEditRates()">âŒ Cancel</button>
  </form>
</div>

<script>
  const SHKEY = "shared-trips";
  const VEHICLES = ["Innova Crysta","Innova Hycross","Force Urbania"];
  let vehicleRates = {};

  function getTripCount(){
    const arr=JSON.parse(localStorage.getItem(SHKEY)||"[]");
    document.getElementById("tripCount").innerText = arr.length;
  }
  function getCurrentId(){
    const c=localStorage.getItem("trip-seq")||"1";
    document.getElementById("currentId").innerText = "#NST"+String(c).padStart(3,"0");
  }
  function exportTrips(){
    const arr=JSON.parse(localStorage.getItem(SHKEY)||"[]");
    if(!arr.length)return alert("No shared trips");
    const ws=XLSX.utils.json_to_sheet(arr);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Trips");
    XLSX.writeFile(wb,"NST_Shared_Trips.xlsx");
  }
  function resetAll(){
    if(confirm("Erase all data?")){
      localStorage.removeItem("trip-seq");
      localStorage.removeItem(SHKEY);
      for(let key in localStorage) if(key.startsWith("#NST")) localStorage.removeItem(key);
      alert("âœ… Reset done");
      getTripCount(); getCurrentId();
    }
  }
  function loadRates(){
    const d=localStorage.getItem("vehicle-packages");
    vehicleRates = d ? JSON.parse(d) : {
      "Innova Crysta":{package:7500,extraHr:1000,extraKm:20,freeKm:80,freeHrs:8},
      "Innova Hycross":{package:8500,extraHr:1200,extraKm:24,freeKm:90,freeHrs:6},
      "Force Urbania":{package:9500,extraHr:1500,extraKm:26,freeKm:70,freeHrs:7}
    };
  }
  function showEditRates(){
    loadRates();
    const ctr=document.getElementById("ratesContainer");
    ctr.innerHTML="";
    VEHICLES.forEach(m=>{
      const r=vehicleRates[m];
      const div=document.createElement("div");
      div.className="rate-box";
      div.innerHTML=`
        <h4>${m}</h4>
        <label>Package â‚¹</label><input name="${m}_package" type="number" value="${r.package}">
        <label>Extra Hr â‚¹</label><input name="${m}_extraHr" type="number" value="${r.extraHr}">
        <label>Extra KM â‚¹</label><input name="${m}_extraKm" type="number" value="${r.extraKm}">
        <label>Free KM</label><input name="${m}_freeKm" type="number" value="${r.freeKm}">
        <label>Free Hrs</label><input name="${m}_freeHrs" type="number" value="${r.freeHrs}">
      `;
      ctr.appendChild(div);
    });
    document.getElementById("editRatesPanel").style.display="block";
  }
  function hideEditRates(){
    document.getElementById("editRatesPanel").style.display="none";
  }
  document.getElementById("ratesForm").addEventListener("submit",e=>{
    e.preventDefault();
    VEHICLES.forEach(m=>{
      vehicleRates[m]={};
      ["package","extraHr","extraKm","freeKm","freeHrs"].forEach(f=>{
        vehicleRates[m][f] = +e.target[`${m}_${f}`].value;
      });
    });
    localStorage.setItem("vehicle-packages",JSON.stringify(vehicleRates));
    alert("âœ… Rates saved!");
    hideEditRates();
  });

  getTripCount(); getCurrentId();
</script>

</body></html>
