<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NST Trip Sheet</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Poppins',sans-serif; background:#f4f6f9; max-width:800px; margin:0 auto; padding:20px }
    h2 { color:#4b2aad }
    label { font-weight:bold; margin-top:10px; display:block }
    input, select, textarea, button {
      width:100%; padding:10px; margin:5px 0 15px;
      border:1px solid #ccc; border-radius:5px; font-size:16px;
    }
    button { background:#4b2aad; color:#fff; border:none; cursor:pointer }
    button:hover { background:#3a208b }
  </style>
</head>
<body>

<h2>üìù NST Trip Sheet</h2>

<label>Trip ID</label>
<input id="tripId" readonly>

<label>Date</label>
<input type="date" id="tripDate">

<label>Pickup Location</label>
<input id="pickupLocation" placeholder="Enter pickup location" type="text">

<label>Drop Location</label>
<input id="dropLocation" placeholder="Enter drop location" type="text">

<label>Customer Name</label>
<input id="custName">

<label>Customer Number</label>
<input id="custNumber">

<label>Driver Name</label>
<select id="driverName"></select>

<label>Driver Number</label>
<select id="driverNumber"></select>

<label>Vehicle Model</label>
<select id="vehicleModel"></select>

<label>Vehicle Number</label>
<select id="vehicleNo"></select>

<label>Start Time</label>
<input type="time" id="startTime">

<label>End Time</label>
<input type="time" id="endTime">

<label>Extra Hours</label>
<input type="number" id="extraHours" placeholder="Enter Extra Hours">

<label>Start KM</label>
<input type="number" id="startKM">

<label>End KM</label>
<input type="number" id="endKM">

<label>Total KM</label>
<input id="totalKM" readonly>

<label>Extra KM</label>
<input type="number" id="extraKM" placeholder="Enter Extra KM">

<label>Total Amount ‚Çπ</label>
<input type="number" id="totalAmount">

<label>Parking ‚Çπ</label>
<input type="number" id="parking" value="0">

<label>Toll ‚Çπ</label>
<input type="number" id="toll" value="0">

<label>Note</label>
<textarea id="note" rows="3"></textarea>

<label>Payment Status</label>
<select id="paymentStatus">
  <option value="Paid">Paid</option>
  <option value="Not Paid">Not Paid</option>
</select>

<button onclick="shareWhatsApp()">üì§ Share via WhatsApp</button>

<script>
  const SHKEY = "shared-trips";

  function genTripId() {
    let n = parseInt(localStorage.getItem("trip-seq") || "1");
    return "#NST" + String(n).padStart(3, "0");
  }

  function reserveTripId() {
    let c = parseInt(localStorage.getItem("trip-seq") || "1");
    localStorage.setItem("trip-seq", c + 1);
    return genTripId();
  }

  function loadDropdowns() {
    const drivers = JSON.parse(localStorage.getItem("driverMaster") || "[]");
    const vehicles = JSON.parse(localStorage.getItem("vehicleMaster") || "[]");

    driverName.innerHTML = "<option>-- Select --</option>" +
      drivers.map(d => `<option>${d.name}</option>`).join("");

    driverNumber.innerHTML = "<option>-- Select --</option>" +
      drivers.map(d => `<option>${d.number}</option>`).join("");

    vehicleModel.innerHTML = "<option>-- Select --</option>" +
      vehicles.map(v => `<option>${v.model}</option>`).join("");

    vehicleNo.innerHTML = "<option>-- Select --</option>" +
      vehicles.map(v => `<option>${v.number}</option>`).join("");
  }

  function shareWhatsApp() {
    const msg = `üìã *TRIP SUMMARY*\n\n*Trip ID:* ${tripId.value}\n*Date:* ${tripDate.value}\n\n` +
      `üìç *Pickup:* ${pickupLocation.value}\nüìç *Drop:* ${dropLocation.value}\n\n` +
      `üë§ *Customer:* ${custName.value} (${custNumber.value})\n` +
      `üë®‚Äç‚úàÔ∏è *Driver:* ${driverName.value} (${driverNumber.value})\nüöò *Vehicle:* ${vehicleModel.value} (${vehicleNo.value})\n\n` +
      `üïí *Start:* ${startTime.value} ‚Äì *End:* ${endTime.value}\n` +
      `üìè *KM:* ${startKM.value} ‚Üí ${endKM.value} = ${totalKM.value} km\n` +
      `‚è± *Extra Hours:* ${extraHours.value}\n‚ûï *Extra KM:* ${extraKM.value}\nüí∞ *Total Amount:* ‚Çπ${totalAmount.value}\n\n` +
      `üíµ *Parking:* ‚Çπ${parking.value}, Toll: ‚Çπ${toll.value}\nüí≥ *Payment:* ${paymentStatus.value}\n\n` +
      `üìù *Note:* ${note.value || '-'}`;

    window.open("https://wa.me/?text=" + encodeURIComponent(msg), '_blank');

    // Save to shared list
    const arr = JSON.parse(localStorage.getItem(SHKEY) || "[]");
    arr.push({
      id: tripId.value,
      date: tripDate.value,
      pickup: pickupLocation.value,
      drop: dropLocation.value,
      cust: custName.value,
      custNo: custNumber.value,
      driver: driverName.value,
      driverNo: driverNumber.value,
      vehicle: vehicleModel.value,
      vehicleNo: vehicleNo.value,
      start: startTime.value,
      end: endTime.value,
      startKM: startKM.value,
      endKM: endKM.value,
      totalKM: totalKM.value,
      extraHrs: extraHours.value,
      extraKM: extraKM.value,
      totalAmt: totalAmount.value,
      parking: parking.value,
      toll: toll.value,
      note: note.value,
      payment: paymentStatus.value
    });
    localStorage.setItem(SHKEY, JSON.stringify(arr));
    tripId.value = reserveTripId();
  }

  startKM.oninput = endKM.oninput = () => {
    let skm = +startKM.value, ekm = +endKM.value;
    totalKM.value = (ekm && skm && ekm > skm) ? (ekm - skm) : 0;
  };

  window.onload = () => {
    tripId.value = genTripId();
    loadDropdowns();
  };
</script>

<!-- Google Places API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFSQJTGHRBDbW_ph7kV2VPT5psO9wfDHQ&libraries=places"></script>
<script>
  function initAutocomplete() {
    const pickup = document.getElementById("pickupLocation");
    const drop = document.getElementById("dropLocation");
    new google.maps.places.Autocomplete(pickup);
    new google.maps.places.Autocomplete(drop);
  }
  google.maps.event.addDomListener(window, 'load', initAutocomplete);
</script>

</body>
</html>
